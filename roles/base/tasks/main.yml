---
- name: add Atom PPA
  apt_repository: repo='ppa:webupd8team/atom'
  become: true

- name: add Gradle PPA
  apt_repository: repo='ppa:cwchien/gradle'
  become: true

- name: add OpenJDK 8 PPA
  apt_repository: repo='ppa:openjdk-r/ppa'
  become: true

- name: install base development packages
  apt: name={{item}} update_cache=yes state=present
  become: true
  with_items:
    - atom
    - curl
    - git
    - chromium-browser
    - gradle
    - openjdk-8-jdk
    - tar
    - unzip
    - wget

- name: copy Dropbox .deb to target
  copy:
    src: dropbox_2015.10.28_amd64.deb
    dest: /tmp/dropbox.deb

- name: Install Dropbox
  apt: deb=/tmp/dropbox.deb
  become: true

- name: Install productivity packages
  apt: name={{item}} update_cache=yes state=present
  become: true
  with_items:
    - ledger
    - hledger

- name: Download IntelliJ IDEA
  get_url:
    url: http://download.jetbrains.com/idea/ideaIU-15.0.2.tar.gz
    force: no
    dest: /tmp/ideaIU-15.0.2.tar.gz

- name: Ensure IDEA installation directory
  file:
    state: directory
    mode: 0775
    dest: /opt/intellij
  become: true

- name: Install IDEA
  unarchive:
    copy: no
    src: /tmp/ideaIU-15.0.2.tar.gz
    dest: /opt/intellij/
  become: true

- name: Checking for Docker
  stat:
    path: /usr/bin/docker
  register: docker_stat

- name: Install Docker
  shell: wget -qO- https://get.docker.com/ | sh
  when: not docker_stat.stat.exists
  become: true

- name: Checking for Docker Compose
  stat:
    path: /usr/local/bin/docker-compose
  register: docker_compose_stat

- name: Install Docker Compose
  shell: curl -L https://github.com/docker/compose/releases/download/1.4.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
  become: yes
  when: not docker_compose_stat.stat.exists

- name: Make Docker Compose executable
  file:
    path: /usr/local/bin/docker-compose
    mode: 0755
  become: true

- name: Fix permissions for all SSH keys
  file:
    path: /home/{{ansible_user_id}}/.ssh/{{item}}
    mode: 0400
  with_items:
    - id_rsa
    - id_rsa.pub

- name: Ensure Projects directory
  file:
    state: directory
    mode: 0775
    dest: /home/{{ansible_user_id}}/Projects

- name: Clone projects from GitHub
  git:
    dest: /home/{{ansible_user_id}}/Projects/{{item}}
    repo: git@github.com:vincecima/{{item}}.git
    accept_hostkey: yes
  with_items:
    - steel-config
    - www.vincecima.com
    - how-much-time-left
    - application-config
