---
- name: Fix permissions for all SSH keys
  file:
    path: /home/{{ansible_user_id}}/.ssh/{{item}}
    mode: 0400
  with_items:
    - id_rsa
    - id_rsa.pub

- name: Add a HOME/bin for commands
  file:
    path: /home/{{ansible_user_id}}/bin
    state: directory

- name: install commands
  copy:
    src: bin/{{item}}
    dest: /home/{{ansible_user_id}}/bin/{{item}}
    mode: 0744
  with_items:
    - hledger-networth

- name: add rcm PPA
  apt_repository: repo='ppa:martin-frost/thoughtbot-rcm'
  become: true

- name: Install base packages
  apt: name={{item}} update_cache=yes state=present
  become: true
  with_items:
    - rcm
    - tmux

- name: Clone dotfiles repo
  git:
    dest: /home/{{ansible_user_id}}/.dotfiles
    repo: git@github.com:vincecima/dotfiles.git
    accept_hostkey: yes
    update: no

- name: Activate dotfiles
  shell: rcup -f
  changed_when: False

- name: Install tmux-sensible
  git:
    dest: /home/{{ansible_user_id}}/.tmux-sensible
    repo: https://github.com/tmux-plugins/tmux-sensible.git
    update: no

- name: Install Tmuxifier
  git:
    dest: /home/{{ansible_user_id}}/.tmuxifier
    repo: https://github.com/jimeh/tmuxifier.git
    update: no
